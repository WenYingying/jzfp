<!DOCTYPE html>
<html>
	<head>
		<title>资助指数</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta id="viewport" content="width=device-width,initial-scale=0.2, maximum-scale=1,user-scalable=no", name="viewport">
		<link rel="stylesheet" type="text/css" href="../css/common.css"/>
		<script type="text/javascript" src="../js/jquery-1.12.1.min.js" ></script>
		<style type="text/css">
			.cont_box{
				height: 52rem;
			}
			.cont_left,.cont_right{
				height: 100%;
			}
			.Anmelden{
				width: 96%;
				padding: 2%;
			    display: block;
			    margin-top: 1rem;
			    border: 1px solid #e6e6e6;
			    background: url(../img/alert_bg.jpg);
			}
			.cont_right_pie>div{
				margin-bottom: 1rem;
			}
			.Anmelden li{
				width: 49%;
				margin-bottom: 1rem;
				display: inline-block;
			}
			.Anmelden li:last-child{
				margin-bottom: 0;
			}
			.Anmelden li>select{
				width: 70%;
			    height: 1.6rem;
				border: 1px solid #ccc;
			    line-height: 1.6rem;
			    color: #333;
			    border-radius: 3px;
			    padding: 0 0.3rem;
			}
			.Anmelden li>span{
			    width: 20%;
				color: #4f4f4f;
			    font-size: 0.7rem;
			    display: inline-block;
			    text-align: right;
			}
			.btn{
		       width: 35%;
		       font-size: 0.8rem;
               height: 1.5rem !important;
               line-height: 1.5rem;
               background-color: #7398c5;
               color: #fff;
               text-align: center;
               display: inline-block;
               border-radius: 0.2rem;
               margin: 0px !important;
			}
			.progress{
				margin-top: 0.5rem;
			}
			.progress>a{
				width: 7rem;
			    margin: 0.5rem 0.5rem;
			    line-height: 1.5rem;
			    height: 1.5rem;
			    display: inline-block;
			    border-radius: 3px;
			    border: 1px solid #CCCCCC;
			     outline: none;
			    padding: 0 0.3rem;
			    font-size: 0.7rem;
			}
			.progress a:hover,.progress a.active{
				border: 1px solid #3b94e1 !important;
    			color: #3b94e1;
			}
		 	.cont_list li div:nth-of-type(1) {
	              width: 6%;
	        }
	
	        .cont_list li div:nth-of-type(2) {
	            width: 15%;
	        }
	
	        .cont_list li div:nth-of-type(3) {
	            width: 17%;
	        }
	
	        .cont_list li div:nth-of-type(4) {
	            width: 28%;
	        }
	
	        .cont_list li div:nth-of-type(5) {
	            width: 10%;
	        }
	
	        .cont_list li div:nth-of-type(6) {
	            width: 10%;
	        }

            .cont_list li div:nth-of-type(7) {
                width: 10%;
            }
            /*弹框*/
            .poverty_alert{
	            width: 100%;
                height: 100%;
                position: fixed;
                background: rgba(0,0,0,0.6);
                left: 0;
                top: 0;
                z-index: 10;
            }
            .poverty_info{
                width: 40rem;
                background-color: #fff;
                margin: 1rem auto;
                border-radius: 5px;
                 height: 20rem;
            }
            .poverty_info>h3{
	            background-color: #fafafa;
                color: #7a7a7a;
                font-size: 0.9rem;
                height:2.25rem;
                line-height: 2.25rem;
                text-align: center;
                border-radius: 5px 5px 0 0;
                position: fixed;
                width: 40rem;
            }
             .poverty_info>h3>text{
                font-weight:600;
            }
            .poverty_info>h3 a{
	            background: url(../img/close.png) no-repeat;
                background-size: 100%;
                width: 0.8rem;
                height: 0.8rem;
                display: block;
                position: absolute;
                top: 0.6rem;
                right: 3%;
            }
             .poverty_top{
	            width: 100%;
                display: inline-block;
                margin-top: 2.25rem;
                overflow-y:auto;
                height:16.6rem;
                padding-bottom:1rem;
            }
             .poverty_top .poverty_top_left{
	            width:94%;
                margin:0.5rem 1rem;
	            display: inline-block;
                vertical-align:top;
            }
          
            .poverty_top .poverty_top_left>h3{
	            width: 100%;
                height: 2rem;
                border-bottom: 1px solid #cccccc;
                color: #333333;
                font-size: 0.8rem;
                line-height: 2rem;
                font-weight: 600;
            }
             .poverty_top .poverty_top_left ul{
	            width: 100%;
	            display: block;
	            overflow: hidden;
	            margin-top: 0.5rem;
            }
             .poverty_top .poverty_top_left ul li{
	             width: 33%;
                display: inline-block;
                margin-top: 0.5rem;
            }
            .poverty_top .poverty_top_left ul li span{
	            display:inline-block;
                font-size: 0.7rem;
                color: #808080;
                margin-right: 0.5rem;
                width: 30%;
                font-weight:600;
                text-align: right;
            }
            .poverty_top .poverty_top_left ul li label{
	                display: inline-block;
                    font-size: 0.7rem;
                    color: #808080;
                    margin-right: 0.5rem;
                    width: 61%;
                    vertical-align: top;
                    margin-top: 0.3rem;
                    word-wrap: break-word;
                    word-break: break-all;
            }
            .poverty_top .poverty_top_left ul li a{
	            width: 3.5rem;
                height: 1.1rem;
                line-height: 1.1rem;
                color: #fff;
                background-color: #7198ba;
                display: block;
                text-align: center;
                border-radius: 3px;
               display:inline-block;
               font-size:0.6rem;
            }
            .poverty_top .poverty_top_left ul .top_left2{
	            width: 33% !important;
	           	display:inline-block;
	
            }
            .listcount{
	            width:100%;
	            height:1.5rem;
	            line-height:1.5rem;
	            color:#4f4f4f;
	            overflow:hidden;
	            font-size:0.7rem;
	         }
	        .listcount>span{
	            color:#005982;
	            font-size:0.8rem;
	        }
	        .cont_list{
	            margin-top:0rem;
	        }
	        .cont_left>.middle{
	        	padding-bottom: 1rem;
	        }
	        .Edure_info{
				width: 100%;
			    display: block;
			    overflow: hidden;
			    border: 1px solid #e6e6e6;
			    background: url(../img/alert_bg.jpg);
			    font-size: 0.8rem;
			    overflow: initial;
			}
			.L_info{
				margin: 0.3rem 0;
			}
			.Edure_info li{
				width: 100%;
			    display: inline-block;
			    height: 2rem;
			    line-height: 2rem;
			}
			.Edure_info>h1{
           	    margin-top: -0.4rem;
			    z-index: 111;
			    margin-left: 0.7rem;
			    width: 51%;
			    font-weight: bold;
			    background-color: #fafafa;
			    text-align: center;
           	}
           	.Edure_info li>div{
           		width: 33%;
           		display: inline-block;
           		text-align: center;
           	}
           	.Edure_info li>div:nth-child(2),.Edure_info li>div:nth-child(3){
           		color: #005982;
           	}
           	.Edure_info li>a{
           		width: 30%;
           		display: inline-block;
           		color: #005982;
           		text-align: center;
           	}
           	.Edure_info>.L_info2 li>div{
           		width: 25%;
           	}
           	.Edure_info>.L_info2 li>a{
           		width: 22%;
           	}
		</style>
	</head>
	<body>
		<div class="cont">
			<div class="cont_box">
				<div class="cont_left">
					<div class="middle" style="border-bottom: 1px solid #f5f5f5;">
						<div id="policyChart" style="width: 100%;height:450px;margin-top:2rem;"></div>
					</div>
					<div class="middle">
						<div id="workChart" style="width: 100%;height:450px;margin-top:2rem;"></div>
					</div>
				</div>
				<div class="cont_right">
					<div class="middle"  style="padding-bottom: 0">
						<h1 class="title">
							<span class="EduPlace"></span>
							<a href="../Poverty/Pager.html" class="a_search gopoverty">精准扶贫</a>
						</h1>
						<div class="cont_right_pie">
                            <div class="Anmelden">
                                <ul>
                                    <li>
                                        <span>市地区</span>
                                        <select id="selectcity"><option value="0">全部</option></select>
                                    </li>
                                    <li>
                                        <span>县地区</span>
                                        <select id="selectcounty"><option value="0">全部</option></select>
                                    </li>
                                    <li>
                                        <span></span>
                                        <a href="javascript:void(0)" class="SearchAll btn">查询</a>
                                    </li>
                                </ul>
                            </div>
							<h1 style="margin-bottom:1rem;">
								 贫困户数
								<span id="HouseSumCount"></span>
                                贫困人数<span id="SumCount"></span>
                                在校人数<span id="InschoolSumCount"></span>
							</h1>
							<div class="Edure_info">
								<h1>各教育阶段资助情况(资助人次/总金额)</h1>
								<div class="L_info L_info2">
									<ul id="policyList">
									</ul>
								</div>
							</div>
							<div class="Edure_info">
								<h1>两后生培训需求统计</h1>
								<div class="L_info">
									<ul id="lhsList">
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../js/jquery-1.12.1.min.js" ></script>
        <script src="../js/Common.js"></script>
        <script src="../js/echarts.js"></script>
        <script src="../js/jquery.page.js"></script>
		<script type="text/javascript">
			$(function(){
				//$('.progress a').click(function(){
				//    $(this).addClass("active").siblings("a").removeClass("active");
				//    GetMonth();
				//});
			    var CityId = getUrlParam("CityId") == null || getUrlParam("CityId") == 0 ? UserList.CityId : getUrlParam("CityId");
			    var CityName = getUrlParam("CityName") == null || getUrlParam("CityName") == "" ? UserList.CityName : getUrlParam("CityName");
			    var ProvinceId = getUrlParam("ProvinceId") == null || getUrlParam("ProvinceId") == 0 ? UserList.ProvinceId : getUrlParam("ProvinceId");
			    var CountyId = getUrlParam("CountyId") == null || getUrlParam("CountyId") == 0 ? UserList.CountyId : getUrlParam("CountyId");
			    var CountyName = getUrlParam("CountyName") == null || getUrlParam("CountyName") == "" ? UserList.CountyName : getUrlParam("CountyName");
			    if (CityId != 0) {
			        $("#selectcity").empty();
			        $("<option>").appendTo($("#selectcity")).val(CityId).text(CityName);
			        GetCountyList(CityId, CountyId, true);
			        $(".EduPlace").text(CityName);
			        if (Number(CountyId) > 0)
			            $(".EduPlace").text(CountyName);
			    }
			    else {
			        $(".EduPlace").text("青海省");
			        GetCityList(true);
			    }
			    $(".SearchAll").click(function () {
				    GetPovertyByEdu();
				    //GetMonth();
				    var CityID = $("#selectcity").val();
				    var CountyID = $("#selectcounty").val();
				    var CountrySideID = 0;
				    var VillageId = 0;
				    if (CountyID != 0) {
				        $(".EduPlace").text($("#selectcounty").children("option:selected").text());
				    }
				    else if (CountyID == 0 && CityID != 0) {
				        $(".EduPlace").text($("#selectcity").children("option:selected").text());
				    }
				    else {
				        $(".EduPlace").text("青海省");
				    }

				});
				//$(".SearchAll").click();
			});

			function GetCityList(tag) {
			    $("#selectcity").empty();
			    $("<option>").appendTo($("#selectcity")).val(0).text("全部");
			    $.post(ServiceUrl + "CityInterface/GetHandler.ashx", { ProvinceID: 29 }, function (data) {
			        var result = JSON.parse(data);
			        if (result != null) {
			            if (result.Result) {
			                $(result.Data).each(function () {
			                    $("<option>").appendTo($("#selectcity")).val(this.ID).text(this.Name);
			                });
			                if (tag) {
			                    GetPovertyByEdu();
			                }
			            }
			        }
			    });
			    $("#selectcity").change(function () {
			        $("#selectcountyside").empty();
			        $("<option>").appendTo($("#selectcountyside")).val(0).text("全部");
			        $("#selectvillage").empty();
			        $("<option>").appendTo($("#selectvillage")).val(0).text("全部");
			        GetCountyList($(this).val(), 0, false);
			    });
			}
			function GetCountyList(CityID, CountyId, tag) {
			    $("#selectcounty").html("");
			    $("<option>").appendTo($("#selectcounty")).val(0).text("全部");
			    $.post(ServiceUrl + "CountyInterface/GetHandler.ashx", { CityID: CityID }, function (data) {
			        var result = JSON.parse(data);
			        if (result != null) {
			            if (result.Result) {
			                $(result.Data).each(function () {
			                    $("<option>").appendTo($("#selectcounty")).val(this.ID).text(this.Name);
			                });
			                $("#selectcounty").val(CountyId);
			                if (tag) GetPovertyByEdu();
			            }
			        }
			    });
			}
			function GetCountrySideList(CountyID) {
			    $("#selectcountyside").empty();
			    $("<option>").appendTo($("#selectcountyside")).val(0).text("全部");
			    $.post(ServiceUrl + "CountrysideInterface/GetHandler.ashx", { CountyID: CountyID }, function (data) {
			        var result = JSON.parse(data);
			        if (result != null) {
			            if (result.Result) {
			                $(result.Data).each(function () {
			                    $("<option>").appendTo($("#selectcountyside")).val(this.ID).text(this.Name);
			                });
			            }
			        }
			    });
			    $("#selectcountyside").change(function () {
			        GetVillageList($(this).val());
			    });
			}
			function GetVillageList(CountrySideID) {
			    $("#selectvillage").empty();
			    $("<option>").appendTo($("#selectvillage")).val(0).text("全部");
			    $.post(ServiceUrl + "VillageInterface/GetHandler.ashx", { CountrySideID: CountrySideID }, function (data) {
			        var result = JSON.parse(data);
			        if (result != null) {
			            if (result.Result) {
			                $(result.Data).each(function () {
			                    $("<option>").appendTo($("#selectvillage")).val(this.ID).text(this.Name);
			                });
			            }
			        }
			    });
			}
			//右侧雷达图
			function GetPovertyByEdu() {
			    var policyChart = echarts.init(document.getElementById('policyChart'));
			    var workChart = echarts.init(document.getElementById('workChart'));
			    var EduLevel = ["学前教育", "义务教育", "高中", "职业教育", "普通高等教育", "特教学生"];
			    var ProvinceID = 29;
			    var CityID = $("#selectcity").val();
			    var CountyID = $("#selectcounty").val();
			    var CountrySideID = 0;
			    var VillageId =0;
			    var sumpovertycount = 0;

			    $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { ProvinceID: 29, CityID: CityID, CountyID: CountyID, CountrySideID: CountrySideID, VillageId: VillageId }, function (data) {
			        var result = JSON.parse(data);
			        if (result.Result) {
			            var PovertyCount = 0;
			            var NotPovertyCount = 0;
			            $(result.Data).each(function () {
			                if (this.PovertyStates == "0") {
			                    PovertyCount += parseInt(this.ID);
			                }
			                else {
			                    NotPovertyCount += parseInt(this.ID);
			                }
			            });
			            var SumCount = parseFloat(PovertyCount) + parseFloat(NotPovertyCount);
			            $("#SumCount").text(SumCount + "人");
			        }
			    });
			    $.post(ServiceUrl + "PovertyArchivesInterface/GetByHouseHandler.ashx", { ProvinceID: 29, CityID: CityID, CountyID: CountyID, CountrySideID: CountrySideID, VillageId: VillageId, Count: 1 }, function (data) {
			        var result = JSON.parse(data);
			        if (result.Result) {
			            var PovertyCount = 0;
			            var NotPovertyCount = 0;
			            if (result.Data.length > 0) {
			                $("#HouseSumCount").text(result.Data[0].ID + "户");
			            }
			            else {
			                $("#HouseSumCount").text("0户");
			            }
			        }
			    });
			    $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { ProvinceID: 29, CityID: CityID, CountyID: CountyID, StudentStatus: 1 }, function (data) {
			        var result = JSON.parse(data);
			        if (result.Result) {
			            var PovertyCount = 0;
			            var NotPovertyCount = 0;
			            $(result.Data).each(function () {
			                if (this.PovertyStates == "0") {
			                    PovertyCount += parseInt(this.ID);
			                }
			                else {
			                    NotPovertyCount += parseInt(this.ID);
			                }
			            });
			            var SumCount = parseFloat(PovertyCount) + parseFloat(NotPovertyCount);
			            $("#InschoolSumCount").text(SumCount + "人");
			        }
			    });

			    var area = "Province", areaid = ProvinceID;
			    if (CityID != 0) {
			        area = "City"; areaid = CityID;
			    }
			    if (CountyID != 0) {
			        area = "County"; areaid = CountyID;
			    }

			    $("#policyList").empty();
			    var policyOption = {
			        title: {
			            text: '帮扶人次分布',
			            subtext: ''
			        },
			        tooltip: {
			            trigger: 'item',
			            formatter: "{a} <br/>{b} : {c}人次 ({d}%)"
			        },
			        //legend: {
			        //    orient: 'horizontal',
			        //    x: 'left',
			        //    data: ['0-3岁', '4-18岁', '19-25岁', '26-59岁', '60岁以上','未知年龄']
			        //},
			        color: ["#01a8df", "#0180cf", "#01d6de", "#01cfa8", "#8bd16e", "#009944"],
			        normal: {
			            // 阴影的大小
			            shadowBlur: 0,
			            // 阴影水平方向上的偏移
			            shadowOffsetX: 0,
			            // 阴影垂直方向上的偏移
			            shadowOffsetY: 0,
			            // 阴影颜色
			            shadowColor: 'rgba(0, 0, 0, 0.5)'
			        },
			        series: [
                        {
                            name: '帮扶政策人数分布',
                            type: 'pie',
                            radius: '80%',
                            data: []
                        }
			        ]
			    };
			    policyChart.setOption(policyOption);
			    $(EduLevel).each(function () {
			        var li = $("<li>").appendTo($("#policyList"));
			        $("<div>").appendTo(li).text(this);
			        var userCntDiv=$("<div>").appendTo(li).text("统计中...");
			        var moneyDiv=$("<div>").appendTo(li).text("统计中...");
			        $.ajax({
			            url: ServiceUrl + "PolicyInterface/CountByPolicyHandler.ashx",
			            data: { "EduLevels": escape(this), "Area": area, "AreaId": areaid },
			            //async: false,
			            method: "post",
                        dataType:"json",
			            success: function (json) {
			                if (json.Result) {
			                    var cnt = 0, money = 0;
			                    $(json.Data).each(function () {
			                        cnt += this.UserCnt;
			                        money += Number(this.Amount) * this.UserCnt;
			                    });
			                    userCntDiv.text("" + cnt + "人次");
			                    moneyDiv.text(money.formatMoney(2, "￥", ",", ".") + "元");
			                    // ["学前", "义务教育", "特教", "高中", "职业", "普通高等"]
			                    policyOption.series[0].data.push({ name: li.children("div:first").text(), value: cnt });
			                    policyChart.setOption(policyOption);
			                    $("<a>").appendTo(li).text("查看").addClass("look").prop("href", "../Poverty/list.html?requesttype=policy&area=" + area + "&areaid=" + areaid + "&edulevels=" + escape(li.children("div:eq(0)").text()) + "&placename=" + escape($(".EduPlace").text()));
			                    return;
			                }
			                userCntDiv.text("计算失败");
			                moneyDiv.text("计算失败");

			            }
			        });
			    });

			    $("#lhsList").empty();
			    var lhsType = new Array('创业培训', '机械操作', '机械加工、维修', '矿产类', '企业新招培训', '轻工类', '"技能+创业"培训', '其他');
			    var workOption = {
			        title: {
			            text: '培训需求人数分布',
			            subtext: ''
			        },
			        tooltip: {
			            trigger: 'item',
			            formatter: "{a} <br/>{b} : {c}人 ({d}%)"
			        },
			        //legend: {
			        //    orient: 'horizontal',
			        //    x: 'left',
			        //    data: ['0-3岁', '4-18岁', '19-25岁', '26-59岁', '60岁以上','未知年龄']
			        //},
			        color: ["#01a8df", "#0180cf", "#01d6de", "#01cfa8", "#8bd16e", "#009944","#0a88ee","#22aadd"],
			        normal: {
			            // 阴影的大小
			            shadowBlur: 0,
			            // 阴影水平方向上的偏移
			            shadowOffsetX: 0,
			            // 阴影垂直方向上的偏移
			            shadowOffsetY: 0,
			            // 阴影颜色
			            shadowColor: 'rgba(0, 0, 0, 0.5)'
			        },
			        series: [
                        {
                            name: '培训需求人数分布',
                            type: 'pie',
                            radius: '80%',
                            data: []
                        }
			        ]
			    };

			    $(lhsType).each(function () {
			        var li = $("<li>").appendTo($("#lhsList"));
			        $("<div>").appendTo(li).text(this);
			        var userCntDiv = $("<div>").appendTo(li).text("统计中...");
			        $.post(ServiceUrl + "WorkInterface/CountByWorkHandler.ashx", { "Type": escape(this),"Area": area, "AreaId": areaid  }, function (json) {
			            if (json.Result)
			            {
			                userCntDiv.text(json.Cnt + "人");
			                $("<a>").appendTo(li).text("查看").addClass("look").prop("href", "../Poverty/list.html?requesttype=work&area=" + area + "&areaid=" + areaid + "&WorkType=" + escape(li.children("div:eq(0)").text()) + "&placename=" + escape($(".EduPlace").text()));
			                workOption.series[0].data.push({ name: li.children("div:first").text(), value: json.Cnt });
			                workChart.setOption(workOption);
			                return;
                        }
			            userCntDiv.text("计算失败");
			        });
			    });
			}
			//function GetMonth() {
			//    var ProvinceID = 29;
			//    var CityID = $("#selectcity").val();
			//    var CountyID = $("#selectcounty").val();
			//    var CountrySideID = $("#selectcountyside").val();
			//    var VillageId = $("#selectvillage").val();
			//    var EduLevel = $(".progress .active").html().replace("不限", "");
			//    var myarea = echarts.init(document.getElementById('main1'));
			//    var monthlist = [];
			//    for (var i = 1; i < 13; i++) {
			//        monthlist.push({
            //            month:i,
			//            PovertyCount: 0,
			//            NotPovertyCount: 0,
			//            monthPovertyRebate: 0
			//        });
			//    }
			//    $(monthlist).each(function () {
			//        var month = this.month;
			//        if (month <= (new Date().getMonth() + 1))
            //            {
			//        $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { Month: month, ProvinceID: ProvinceID, CityID: CityID, CountyID: CountyID, CountrySideID: CountrySideID, EduLevels: EduLevel, VillageId: VillageId, StudentStatus:1 }, function (data) {
			//            var result = JSON.parse(data);
			//            if (result.Result) {
			//                var OutPovertyCount = 0;
			//                $(result.Data).each(function () {
			//                    if (this.PovertyStates != "0") {
			//                        OutPovertyCount += parseInt(this.ID);
			//                    }
			//                });
			//                $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { EndMonth: month, ProvinceID: ProvinceID, CityID: CityID, CountyID: CountyID, CountrySideID: CountrySideID, EduLevels: EduLevel, VillageId: VillageId, StudentStatus: 1 }, function (res) {
			//                    var json = JSON.parse(res);
			//                    var AllPovertyCount = 0;
			//                    $(json.Data).each(function () {
			//                        AllPovertyCount += parseInt(this.ID);
			//                    });
			//                    var PovertyCount = AllPovertyCount - OutPovertyCount;
			//                    var sumcount = parseInt(PovertyCount) + parseInt(OutPovertyCount);
			//                    var povertyrebate = 0;
			//                    if (sumcount > 0) {
			//                        povertyrebate = parseFloat(OutPovertyCount / sumcount * 100).toFixed(2);
			//                    }
			//                    monthlist[month - 1] = {
			//                        PovertyCount: PovertyCount,
			//                        NotPovertyCount: OutPovertyCount,
			//                        monthPovertyRebate: povertyrebate
			//                    };

			//                    loadmonthchart(myarea, monthlist);
			//                });
			           
			//            }
			//        });
			//        }
			//    });
			//    $("#currentarea").text("加载中");
			//    $("#currentoutpc").text("加载中");
			//    $("#currentpc").text("加载中");
			//    $("#currentoutpcrebate").text("加载中");
			//    $("#currentpcrebate").text("加载中");
			//    $(".Edulevelstr").text(EduLevel == "" ? "所有阶段" : EduLevel);
			//    $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { ProvinceID: ProvinceID, CityID: CityID, CountyID: CountyID, CountrySideID: CountrySideID, EduLevels: EduLevel, VillageId: VillageId, StudentStatus: 1 }, function (res) {
			//        var json = JSON.parse(res);
			//        if(json.Result)
			//        {
			//            var povertyCount = 0;
			//            var OutPovertyCount = 0;
			//            $(json.Data).each(function () {
			//                if (this.PovertyStates == "0") {
			//                    povertyCount += parseInt(this.ID);
			//                }
			//                else {
			//                    OutPovertyCount += parseInt(this.ID);
			//                }
			//            });
			//            var sumcount = parseInt(OutPovertyCount) + parseInt(povertyCount);
			//                $("#currentarea").text(sumcount+"人");
			//                $("#currentoutpc").text(OutPovertyCount + "人");
			//                $("#currentpc").text(povertyCount + "人");
			//                var povertyrebate = 0;
			//                var outpovertyrebate = 0;
			//                if (sumcount > 0) {
			//                    povertyrebate = (povertyCount / sumcount * 100).toFixed(2);
			//                    outpovertyrebate = (OutPovertyCount / sumcount * 100).toFixed(2);
			//                }
			//                $("#currentoutpcrebate").text(outpovertyrebate + "%");
			//                $("#currentpcrebate").text(povertyrebate + "%");
			//        }
			//    });

			//}
			function loadmonthchart(doc, data) {
			    var PovertyCountlist = [], NotPovertyCountlist = [], monthPovertyRebatelist = []
			    $(data).each(function () {
			        PovertyCountlist.push(this.PovertyCount);
			        NotPovertyCountlist.push(this.NotPovertyCount);
			        monthPovertyRebatelist.push(this.monthPovertyRebate);
			    });
			    var option = {
			        tooltip: {
			            trigger: 'axis'
			        },
			     
			        legend: {
			            data: ['未复核', '已复核', '复核比例']
			        },
			        xAxis: [
                        {
                            type: 'category',
                            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月']
                        }
			        ],
			        yAxis: [
                        {
                            type: 'value',
                            name: '人数',
                            //min: 0,
                            //max: 250,
                            //interval: 50,
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: '比例(%)',
                            min: 0,
                            max: 100,
                            //interval: 20,
                            axisLabel: {
                                formatter: '{value}'
                            }
                        }
			        ],
			        series: [
                        {
                            name: '未复核',
                            type: 'bar',
                            data: PovertyCountlist
                        },
                        {
                            name: '已复核',
                            type: 'bar',
                            data: NotPovertyCountlist
                        },
                        {
                            name: '复核比例',
                            type: 'line',
                            yAxisIndex: 1,
                            data: monthPovertyRebatelist
                        }
			        ]
			    };
			    doc.setOption(option);
			}
			var pagesize = 15;
			var PageCheck = true;
			function GetList(Pageno) {
			    var ProvinceID = 29;
			    var CityID = $("#selectcity").val();
			    var CountyID = $("#selectcounty").val();
			    var CountrySideID = $("#selectcountyside").val();
			    var VillageId = $("#selectvillage").val();
			    var SearchText = $("#SearchText").val();
			    var IdCardNo = "";
			    var Name = "";
			    if (!/[\u4e00-\u9fa5]/g.test(SearchText)) {
			        IdCardNo = SearchText;
			    }
			    else {
			        Name = SearchText;
			    }
			    $("div[data-role='povertylist'] .povertyli").remove();
			    $.post(ServiceUrl + "PovertyArchivesInterface/PagerByHouseHandler.ashx", { pageno: Pageno, pagesize: pagesize, ProvinceID: ProvinceID, CityID: CityID, CountyID: CountyID, CountrySideID: CountrySideID, VillageId: VillageId, Name: Name, IdCardNo: IdCardNo }, function (data) {
			        var result = JSON.parse(data);
			        if (result != null) {
			            if (result.Result) {
			                $(".listcount>span").text(result.RecordCount);
			                if (PageCheck) {
			                    PageCheck = false;
			                    $(".clear").empty();
			                    $("<div>").appendTo($(".clear")).addClass("tcdPageCode").createPage({
			                        pageCount: result.PageCount,
			                        current: 1,
			                        backFn: function (p) {
			                            GetList(p);
			                        }
			                    });
			                }
			                var list = $("div[data-role='povertylist'] ul");
			                var pagenumber = Pageno * 20 - 19;
			                $(result.Data).each(function () {
			                    var ID = this.ID;
			                    var IdCardNo = this.IdCardNo;
			                    var povertyli = $("<li>").appendTo(list).addClass("povertyli");
			                    $("<div>").appendTo(povertyli).text(pagenumber).css("width", "7%");
			                    pagenumber++;
			                    $("<a>").appendTo($("<div>").appendTo(povertyli)).css("width", "15%").prop("href", "javascript:void(0)").addClass("name").text(this.Name).click(function () {
			                        GetDetailByHoseHold(ID);
			                    });
			                    //证件号
			                    $("<div>").appendTo(povertyli).css("width", "18%").text(this.IdCardNo);
			                    //住址
			                    var Region = (this.CountyName == null ? "" : this.CountyName) + (this.CountrySideName == null ? "" : this.CountrySideName) + (this.VillageName == null ? "" : this.VillageName) + (this.Address == null ? "" : this.Address);
			                    $("<div>").appendTo(povertyli).css("width", "28%").text(Region);
			                    //家庭人数
			                    $("<div>").appendTo(povertyli).css("width", "10%").text(this.FamilySize);
			                    //家庭在读人数
			                    var inschooldiv = $("<div>").css("width", "11%").appendTo(povertyli).text(this.InSchoolCount);
			                    //贫困状态
			                    if (this.PovertyStates == "1") {
			                        
			                        $("<div>").css("width", "11%").appendTo(povertyli).text("已复核");
			                    }
			                    else {
			                        $("<div>").css("width", "11%").appendTo(povertyli).text("未复核");
			                    }

			                });
			            }
			        }

			    });

			}
			function GetDetailByHoseHold(HouseHolderId) {
			    $(parent.document).find(".household_alert").empty();
			    $(parent.document).find(".household_alert").css("display", "inline-block");
			    var nam_alert = $("<div>").appendTo($(parent.document).find(".household_alert")).addClass("nam_alert");
			    var h1 = $("<h1>").appendTo(nam_alert);
			    $("<text>").appendTo(h1).text("贫困档案");
			    $("<a>").appendTo(h1).prop("href", "javascript:void(0)").addClass("iconfont").html("&#xe60e;").click(function () {
			        $(parent.document).find(".household_alert").hide();
			        $(parent.document).find(".household_alert").empty();
			    });
			    var name_box = $("<div>").appendTo(nam_alert).addClass("name_box");
			    var middle1 = $("<div>").appendTo(name_box).addClass("middle");
			    $("<h1>").appendTo(middle1).addClass("title").text("户口信息");
			    var Anmelden1 = $("<ul>").appendTo(middle1).addClass("Anmelden");
			    var middle2 = $("<div>").appendTo(name_box).addClass("middle");
			    $("<h1>").appendTo(middle2).addClass("title").text("贫困信息");
			    var Anmelden2 = $("<ul>").appendTo(middle2).addClass("Anmelden");
			    $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { ID: HouseHolderId }, function (res) {
			        var json = JSON.parse(res);
			        if (json.Result) {
			            if (json.Data.length > 0) {

			                //户主姓名
			                var li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("户主姓名:");
			                $("<div>").appendTo(li).text(json.Data[0].Name);
			                //户主证件
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("户主证件:");
			                $("<div>").appendTo(li).text(json.Data[0].IdCardNo);

			                //城市
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("市/州:");
			                $("<div>").appendTo(li).text(json.Data[0].CityName);
			                //县/区
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("县/区:");
			                $("<div>").appendTo(li).text(json.Data[0].CountyName);
			                //乡/镇
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("乡/镇:");
			                $("<div>").appendTo(li).text(json.Data[0].CountrySideName);
			                //村/居委会
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("村/居委会:");
			                $("<div>").appendTo(li).text(json.Data[0].VillageName);
			                //详细地址
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("详细地址:");
			                $("<div>").appendTo(li).text(json.Data[0].Address);
			                //家庭人数
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("家庭人数:");
			                $("<div>").appendTo(li).text(json.Data[0].FamilySize + "人");
			                //联系电话
			                li = $("<li>").appendTo(Anmelden1);
			                $("<span>").appendTo(li).text("联系电话:");
			                $("<div>").appendTo(li).text(json.Data[0].Phone);
			                //贫困原因
			                li = $("<li>").appendTo(Anmelden2);
			                $("<span>").appendTo(li).text("贫困原因:");
			                $("<div>").appendTo(li).text(json.Data[0].PovertyReason);
			                //贫困属性
			                li = $("<li>").appendTo(Anmelden2);
			                $("<span>").appendTo(li).text("贫困原因:");
			                $("<div>").appendTo(li).text(json.Data[0].PovertyProperties);
			                //识别标准
			                li = $("<li>").appendTo(Anmelden2);
			                $("<span>").appendTo(li).text("识别标准:");
			                $("<div>").appendTo(li).text(json.Data[0].DiscerningStandards);
			            }
			        }
			    });
			    var middle3 = $("<div>").appendTo(name_box).addClass("middle");
			    $("<h1>").appendTo(middle3).addClass("title").text("家庭成员信息");
			    $.post(ServiceUrl + "PovertyArchivesInterface/GetHandler.ashx", { HouseHolderId: HouseHolderId }, function (res) {
			        var json = JSON.parse(res);
			        if (json.Result) {
			            var data = [];
			            var familydata = PaiXu(json.Data);
			            $(familydata).each(function () {
			                var div = $("<div>").appendTo(middle3);
			                var Anmelden3 = $("<ul>").appendTo(div).addClass("Anmelden");
			                var anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("姓名:");
			                $("<div>").appendTo(anmeldenli).text(this.Name);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("证件号码:");
			                $("<div>").appendTo(anmeldenli).text(this.IdCardNo);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("民族信息:");
			                $("<div>").appendTo(anmeldenli).text(this.Nation);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("性别:");
			                if (this.Gender == "True") {
			                    $("<div>").appendTo(anmeldenli).text("男");
			                }
			                else {
			                    $("<div>").appendTo(anmeldenli).text("女");
			                }
			                var Birthday = new Date(this.BirthDay).getFullYear() + "-" + checklength(new Date(this.BirthDay).getMonth() + 1) + "-" + checklength(new Date(this.BirthDay).getDate());
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("出生日期:");
			                $("<div>").appendTo(anmeldenli).text(Birthday);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("是否复核:");
			                if (this.PovertyStates == "1") {
			                    
			                    $("<div>").appendTo(anmeldenli).text("已复核").css("color", "#008B00");
			                }
			                else {
			                    $("<div>").appendTo(anmeldenli).text("未复核").css("color", "#f00");
			                }
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("户主关系:");
			                $("<div>").appendTo(anmeldenli).text(this.HouseholderRelation);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("文化程度:");
			                $("<div>").appendTo(anmeldenli).text(this.DropoutSchool == "" ? "未辍学" : this.DropoutSchool);
			                if (this.DropoutSchool != "" && this.DropoutSchool != null && this.DropoutSchool != undefined && this.DropoutSchool != "NULL") {
			                    anmeldenli = $("<li>").appendTo(Anmelden3);
			                    $("<span>").appendTo(anmeldenli).text("劝返情况:");
			                    $("<div>").appendTo(anmeldenli).text(this.ReturnSchool == "True" ? "已返校" : "未返校");
			                }
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("省内外就读:");
			                if (this.IsProvinceStudy == "True") {
			                    $("<div>").appendTo(anmeldenli).text("省内");
			                }
			                else {
			                    $("<div>").appendTo(anmeldenli).text("省外");
			                }
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("培训需求:");
			                if (this.studentArchivesID == 0) {
			                    $("<div>").appendTo(anmeldenli).text("有");
			                    var peixunli = $("<li>").appendTo(Anmelden3);
			                    $("<span>").appendTo(peixunli).text("培训:");
			                    $("<div>").appendTo(peixunli).text("无需求");
			                }
			                else {


			                    if (this.IsLHS == "True") {
			                        $("<div>").appendTo(anmeldenli).text("有");
			                        var peixunli = $("<li>").appendTo(Anmelden3);
			                        $("<span>").appendTo(peixunli).text("培训:");
			                        if (this.LHSWorkId != 0 && this.LHSWorkId != "" && this.LHSWorkId != null && this.LHSWorkId != undefined && this.LHSWorkId != NaN) {
			                            $.post(ServiceUrl + "WorkInterface/GetHandler.ashx", { ID: this.LHSWorkId }, function (res) {
			                                var json = JSON.parse(res);
			                                if (json.Result) {
			                                    if (json.Data.length > 0) {
			                                        $("<div>").appendTo(peixunli).text(json.Data[0].Name);
			                                    }
			                                }

			                            });
			                        }
			                    }
			                    else {
			                        $("<div>").appendTo(anmeldenli).text("无");
			                    }
			                }
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("教育阶段:");
			                $("<div>").appendTo(anmeldenli).text(this.EduLevels);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("年级:");
			                $("<div>").appendTo(anmeldenli).text(this.StudentStatus);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("学校性质:");
			                if (this.SchoolNature == "True") {
			                    $("<div>").appendTo(anmeldenli).text("公办");
			                }
			                else {
			                    $("<div>").appendTo(anmeldenli).text("民办");
			                }
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("学校名称:");
			                $("<div>").appendTo(anmeldenli).text(this.SchoolName);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("学号:");
			                $("<div>").appendTo(anmeldenli).text(this.StudentNo);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("未入学原因:");
			                var outschooldiv = $("<div>").appendTo(anmeldenli);
			                var Outschoolreason = "";
			                $(this.OutpreschoolReason.toString().split('|')).each(function () {
			                    var Outpreschoolid = this.toString();
			                    if (Outpreschoolid == "" || Outpreschoolid == null) {
			                        return;
			                    }
			                    $.post(ServiceUrl + "OutPreschoolReasonInterface/GetHandler.ashx", { ID: Outpreschoolid }, function (res) {
			                        var json = JSON.parse(res);
			                        if (json.Result) {
			                            $(json.Data).each(function () {
			                                Outschoolreason += this.Name + " ";
			                                outschooldiv.text(Outschoolreason);
			                            });
			                        }
			                    });
			                });

			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("备注:");
			                $("<div>").appendTo(anmeldenli).text(this.Remark);
			                anmeldenli = $("<li>").appendTo(Anmelden3);
			                $("<span>").appendTo(anmeldenli).text("帮扶政策:");
			                var policydiv = $("<div>").appendTo(anmeldenli);
			                $(this.PolicyID.split(",")).each(function () {
			                    var policyid = this.toString();
			                    $.post(ServiceUrl + "PolicyInterface/GetHandler.ashx", { ID: policyid }, function (res1) {
			                        var json1 = JSON.parse(res1);
			                        if (json1.Result) {
			                            if (json1.Data.length > 0) {
			                                var p = $("<p>").appendTo(policydiv).text(json1.Data[0].Name + "(补助金额：" + json1.Data[0].Amount + "元）,");
			                            }
			                        }
			                    });
			                });
			            });
			        }
			    });
			}
		</script>
	</body>
</html>
